@{
    ViewBag.Title = "Bulk Mail Sender Dashboard";
}

<!-- ✅ Layout Styling -->
<style>
    .split-container {
        display: flex;
        height: 100vh;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }

    .left-view {
        flex: 0 0 60%;
        padding: 20px;
        border-right: 2px solid #ccc;
        overflow-y: auto;
    }

    .right-view {
        flex: 0 0 40%;
        padding: 20px;
        overflow-y: auto;
        background-color: #f8f9fa;
    }

    h2 {
        color: #333;
        margin-bottom: 15px;
    }

    label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
    }

    input[type="text"], textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    button {
        margin-top: 15px;
        padding: 8px 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

        button:hover {
            background-color: #0056b3;
        }

    #statusArea {
        margin-top: 20px;
        font-family: monospace;
    }
</style>

<!-- ✅ Layout -->
<div class="split-container">
    <!-- Left 60%: Index view -->
    <div class="left-view">
        @Html.Partial("Index")
    </div>

    <!-- Right 40%: Results view -->
    <div class="right-view" id="resultContainer">
        @Html.Partial("Results")
    </div>
</div>

<!-- ✅ Scripts -->
@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Handle the form submission in Index.cshtml via AJAX
        $(document).on("submit", "#mailForm", function (e) {
            e.preventDefault();

            let formData = new FormData(this);
            $("#statusArea").html("<p>Sending...</p>");

            $.ajax({
                url: '/Mail/SendMails',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    $("#statusArea").empty();

                    // Show live status results
                    data.forEach((result) => {
                        let color = result.status === "success" ? "green" : "red";
                        $("#statusArea").append(`<p style="color:${color}">${result.message}</p>`);
                    });

                    
                },
                error: function (xhr) {
                    $("#statusArea").html("<p style='color:red'>Error: " + xhr.responseText + "</p>");
                }
            });
        });
    </script>
}
